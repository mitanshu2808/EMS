@model EMS.Data.FormModels.EmpSalary.EmpSalaryVM
@{
    ViewData["Title"] = "Add Salary";
    int totalPaidDays = 0;
}

<h1>Add Employee Salary</h1>
<hr />
<div class="row">
    <div class="col-md-12">
        <form asp-action="Create">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            
            <div class="form-outline mt-2 row">
                <div class="form-outline col-md-3">
                <div class="col">
                    <label asp-for="RequestingEmpId" class="form-label" for="form3Example9">Select Employee</label>
                </div>
                <div class="col">
                    @Html.DropDownListFor(a => a.RequestingEmpId, new SelectList(@ViewBag.Employee, "Value", "Text"), "Select Employee", new { @class = "form-control"})
                    <span asp-validation-for="RequestingEmpId" class="text-danger"></span>
                </div>
                </div>
                <div class="form-outline col-md-3">
                <div class="col">
                    <label asp-for="Designation" class="control-label">Designation</label>
                </div>
                <div class="col">
                    <input type="text" asp-for="Designation" class="form-control" />
                    <span asp-validation-for="Designation" class="text-danger"></span>
                </div>
            </div>
            </div>
            <div class="form-outline mt-2 row">
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="Department" class="control-label">Department</label>
                    </div>
                    <div class="col">
                        <input type="text" asp-for="Department" class="form-control" />
                        <span asp-validation-for="Department" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="TotalWorkingDays" class="control-label">Total Working Days</label>
                    </div>
                    <div class="col">
                        <input type="number" readonly asp-for="TotalWorkingDays" id="txtTotalDays" value="@DateTime.DaysInMonth(DateTime.Now.Year, DateTime.Now.Month)" class="form-control" />
                        <span asp-validation-for="TotalWorkingDays" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="form-outline mt-2 row">
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="LOPDays" class="control-label">LOP Days</label>
                    </div>
                    <div class="col">
                        <input type="number" asp-for="LOPDays" id="txtLOPDays" class="form-control" />
                        <span asp-validation-for="LOPDays" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="TotalLeaves" class="control-label">Total Leave</label>
                    </div>
                    <div class="col">
                        <input type="text" id="txtTL" asp-for="TotalLeaves" class="form-control" />
                        <span asp-validation-for="TotalLeaves" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="form-outline mt-2 row">
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="BankName" class="control-label">Bank Name</label>
                    </div>
                    <div class="col">
                        <input type="text" asp-for="BankName" class="form-control" />
                        <span asp-validation-for="BankName" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="AccountNumber" class="control-label">Account Number</label>
                    </div>
                    <div class="col">
                        <input type="text" asp-for="AccountNumber" class="form-control" />
                        <span asp-validation-for="AccountNumber" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="form-outline mt-2 row">
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="PaidDays" class="control-label">Paid Days</label>
                    </div>
                    <div class="col">
                        <input type="number" asp-for="PaidDays" id="txtPaidDays" class="form-control" />
                        <span asp-validation-for="PaidDays" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="SalaryAmount" class="control-label">Salary</label>
                    </div>
                    <div class="col">
                        <input type="text" id="txtSalary" asp-for="SalaryAmount" class="form-control" />
                        <span asp-validation-for="SalaryAmount" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="form-outline mt-3 row">
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="DailySalary" class="control-label">Daily Salary</label>
                    </div>
                    <div class="col">
                        <input type="text" id="txtDS" asp-for="DailySalary" class="form-control" />
                        <span asp-validation-for="DailySalary" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="ProfessionalTax" class="control-label">Professional Tax</label>
                    </div>
                    <div class="col">
                        <input type="text" id="txtPT" asp-for="ProfessionalTax" class="form-control" />
                        <span asp-validation-for="ProfessionalTax" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="form-outline mt-3 row">
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="LeaveDeduction" class="control-label">Leave Deduction</label>
                    </div>
                    <div class="col">
                        <input type="text" id="txtLD" asp-for="LeaveDeduction" class="form-control" />
                        <span asp-validation-for="LeaveDeduction" class="text-danger"></span>
                    </div>
                </div>
                <div class="form-outline col-md-3">
                    <div class="col">
                        <label asp-for="NetSalary" class="control-label">Net Salary</label>
                    </div>
                    <div class="col">
                        <input type="text" id="txtNetSalary" asp-for="NetSalary" class="form-control" />
                        <span asp-validation-for="NetSalary" class="text-danger"></span>
                    </div>
                </div>
            </div>
            <div class="form-group mt-2">
                <button type="submit" class="btn btn-primary">Add Amount</button>
                <button class="btn btn-secondary" asp-action="Index">Back to List</button>
            </div>
        </form>
    </div>
</div>

@section Scripts{
    <script>
        $(function () {
            $(".datepicker").datepicker({
                dateFomat: "yy-mm-dd",
            });
        });
        // $("#txtLOPDays").on("input", function () {
        //     document.getElementById("txtPaidDays").value = document.getElementById("txtTotalDays").value - $(this).val();
        // });
        // $("txtTL").on("input", function () {
        //     debugger
        //     document.getElementById("txtPaidDays").value = document.getElementById("txtTotalDays").value - $(this).val();
        // })
        // $("#txtSalary").on("input", function () {
        //     document.getElementById("txtNetSalary").value = $(this).val();
        //     document.getElementById("txtDS").value = document.getElementById("txtNetSalary").value / document.getElementById("txtTotalDays").value;
        //     document.getElementById("txtLD").value = document.getElementById("txtDS").value * document.getElementById("txtTL").value;
        //     document.getElementById("txtNetSalary").value = document.getElementById("txtSalary").value - document.getElementById("txtPT").value - document.getElementById("txtLD").value;
        // });
        // $("#txtPT").on("input", function () {
        //     debugger;
        //     document.getElementById("txtNetSalary").value = document.getElementById("txtSalary").value - document.getElementById("txtLD").value - $(this).val();
        // });
        // $("txtLD").on("input", function () {
        //     debugger
        //     document.getElementById("txtNetSalary").value = document.getElementById("txtSalary").value - document.getElementById("txtPT").value - $(this).val();
        // })

        $(document).ready(function () {
            function calculatePaidDays() {
                const totalDays = parseFloat($("#txtTotalDays").val()) || 0;
                const lopDays = parseFloat($("#txtLOPDays").val()) || 0;
                const totalLeaves = parseFloat($("#txtTL").val()) || 0;
                const paidDays = totalDays - lopDays - totalLeaves;
                $("#txtPaidDays").val(paidDays.toFixed(0));
            }

            function calculateLeaveDeduction() {
                const dailySalary = parseFloat($("#txtDS").val()) || 0;
                const totalLeaves = parseFloat($("#txtTL").val()) || 0;
                const leaveDeduction = dailySalary * totalLeaves;
                $("#txtLD").val(leaveDeduction.toFixed(0));
            }

            function calculateNetSalary() {
                const salary = parseFloat($("#txtSalary").val()) || 0;
                const professionalTax = parseFloat($("#txtPT").val()) || 0;
                const leaveDeduction = parseFloat($("#txtLD").val()) || 0;
                const netSalary = salary - professionalTax - leaveDeduction;
                $("#txtNetSalary").val(netSalary.toFixed(0));
            }

            $("#txtLOPDays").on("input", function () {
                calculatePaidDays();
            });

            $("#txtTL").on("input", function () {
                calculateLeaveDeduction();
                calculatePaidDays();
                calculateNetSalary();
            });

            $("#txtSalary").on("input", function () {
                calculateNetSalary();
                const totalDays = parseFloat($("#txtTotalDays").val()) || 0;
                const salary = parseFloat($(this).val()) || 0;
                const dailySalary = salary / totalDays;
                $("#txtDS").val(dailySalary.toFixed(0)); 
                calculateLeaveDeduction();
            });

            $("#txtPT").on("input", function () {
                calculateNetSalary();
            });

            $("#txtLD").on("input", function () {
                calculateNetSalary();
            });
        });

        
    </script>
}